<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Plux | Dashboard Antifraude</title>
    <meta name="description"
        content="Panel analítico de monitoreo antifraude en tiempo real para analistas de riesgo de Plux." />

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="../styles.css" />

    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #f8f7fc;
            min-height: 100vh;
            color: #1e1b2e;
        }

        svg {
            overflow: hidden;
        }

        /* ── Header ─────────────── */
        .dash-header {
            background: white;
            border-bottom: 1px solid #ede9fe;
            position: sticky;
            top: 0;
            z-index: 50;
            box-shadow: 0 1px 6px rgba(124, 58, 237, 0.06);
        }

        /* ── KPI cards ──────────── */
        .kpi-card {
            background: white;
            border: 1px solid #ede9fe;
            border-radius: 16px;
            padding: 1.25rem;
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.06);
        }

        .kpi-value {
            font-size: 1.75rem;
            font-weight: 800;
            letter-spacing: -0.03em;
            color: #1e1b2e;
            line-height: 1.1;
        }

        /* ── Panel cards ─────────── */
        .panel-card {
            background: white;
            border: 1px solid #ede9fe;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.06);
            overflow: hidden;
        }

        .panel-header {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .panel-title {
            font-size: 13px;
            font-weight: 700;
            color: #1e1b2e;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-body {
            padding: 1rem 1.25rem;
        }

        /* ── Feed items ─────────── */
        .feed-item {
            list-style: none;
        }

        /* ── Geo table ──────────── */
        .geo-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .geo-table thead th {
            padding: 8px 12px;
            font-size: 11px;
            font-weight: 600;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            text-align: left;
            background: #f9fafb;
            border-bottom: 1px solid #f3f4f6;
        }

        .geo-table tbody tr:hover {
            background: #faf5ff;
        }

        /* ── Loading overlay ────── */
        .loading-overlay {
            position: fixed;
            inset: 0;
            z-index: 100;
            background: rgba(248, 247, 252, 0.85);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loading-spinner {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 3.5px solid #ede9fe;
            border-top-color: #7c3aed;
            animation: spin 0.85s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* ── Refresh button ─────── */
        .refresh-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 10px;
            background: #f5f3ff;
            color: #7c3aed;
            border: 1px solid #ede9fe;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
        }

        .refresh-btn:hover {
            background: #ede9fe;
        }

        .refresh-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ── Period select ──────── */
        .period-select {
            border: 1.5px solid #ede9fe;
            border-radius: 8px;
            padding: 5px 10px;
            font-size: 12px;
            color: #374151;
            background: white;
            cursor: pointer;
            outline: none;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
        }

        .period-select:focus {
            border-color: #7c3aed;
        }
    </style>
</head>

<body>

    <!-- ── Loading overlay ──────────────────────────────────────── -->
    <div id="loading-overlay" class="loading-overlay" style="display:none;">
        <div style="text-align:center;">
            <div class="loading-spinner" style="margin:0 auto 12px;"></div>
            <p style="font-size:13px;font-weight:600;color:#7c3aed;">Cargando datos reales…</p>
        </div>
    </div>

    <!-- ── HEADER ───────────────────────────────────────────────── -->
    <header class="dash-header">
        <div style="max-width:1280px;margin:0 auto;padding:0 1.5rem;height:60px;
                    display:flex;align-items:center;justify-content:space-between;gap:1rem;">

            <!-- Izquierda: logo + título -->
            <div style="display:flex;align-items:center;gap:12px;">
                <a href="../motor/index.html" style="display:inline-flex;align-items:center;gap:6px;
                          padding:6px 14px;border-radius:10px;
                          border:1.5px solid #ede9fe;background:#f5f3ff;
                          font-size:12px;font-weight:600;color:#7c3aed;
                          text-decoration:none;transition:background 0.15s;"
                    onmouseover="this.style.background='#ede9fe'" onmouseout="this.style.background='#f5f3ff'">
                    <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" fill="none" stroke="currentColor"
                        stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                        <polyline points="15 18 9 12 15 6" />
                    </svg>
                    Motor
                </a>

                <div>
                    <p style="font-size:14px;font-weight:800;color:#1e1b2e;line-height:1.1;">
                        Dashboard Antifraude
                    </p>
                    <p style="font-size:11px;color:#8b5cf6;font-weight:500;line-height:1.1;">
                        Plux Engine v1 · Datos reales desde FastAPI
                    </p>
                </div>
            </div>

            <!-- Centro: selector de período -->
            <div style="display:flex;align-items:center;gap:8px;">
                <label for="period-select" style="font-size:11px;font-weight:600;color:#9ca3af;">
                    Período:
                </label>
                <select id="period-select" class="period-select">
                    <option value="6">Últimas 6h</option>
                    <option value="24" selected>Últimas 24h</option>
                    <option value="48">Últimas 48h</option>
                    <option value="72">Últimas 72h</option>
                    <option value="168">Última semana</option>
                </select>
                <button id="refresh-btn" class="refresh-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" stroke="currentColor"
                        stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                        <polyline points="23 4 23 10 17 10" />
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10" />
                    </svg>
                    Actualizar
                </button>
            </div>

            <!-- Derecha: estado + logout -->
            <div style="display:flex;align-items:center;gap:12px;">
                <div style="display:flex;align-items:center;gap:6px;
                            font-size:11px;font-weight:600;color:#16a34a;">
                    <span style="width:7px;height:7px;border-radius:50%;
                                 background:#22c55e;animation:pulse 1.5s infinite;
                                 display:inline-block;"></span>
                    <span id="last-updated">Conectando…</span>
                </div>
                <button onclick="handleLogout()" style="font-size:12px;color:#9ca3af;background:none;border:none;
                               cursor:pointer;padding:5px 10px;border-radius:8px;
                               border:1px solid #e5e7eb;transition:all 0.15s;"
                    onmouseover="this.style.background='#fef2f2';this.style.color='#dc2626'"
                    onmouseout="this.style.background='none';this.style.color='#9ca3af'">
                    Salir →
                </button>
            </div>
        </div>
    </header>

    <!-- ── MAIN ─────────────────────────────────────────────────── -->
    <main style="max-width:1280px;margin:0 auto;padding:2rem 1.5rem;display:flex;flex-direction:column;gap:1.5rem;">

        <!-- ── ROW 1: KPIs ──────────────────────────────────────── -->
        <section>
            <h2 style="font-size:11px;font-weight:700;text-transform:uppercase;
                       letter-spacing:0.08em;color:#8b5cf6;margin-bottom:1rem;">
                KPIs Globales
            </h2>
            <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;">

                <!-- Volumen -->
                <article class="kpi-card">
                    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
                        <span style="font-size:11px;font-weight:600;color:#8b5cf6;
                                     text-transform:uppercase;letter-spacing:0.06em;">
                            Volumen
                        </span>
                        <div style="width:28px;height:28px;border-radius:8px;
                                    background:#f5f3ff;border:1px solid #ede9fe;
                                    display:flex;align-items:center;justify-content:center;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" stroke="#7c3aed"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                                <line x1="12" y1="1" x2="12" y2="23" />
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
                            </svg>
                        </div>
                    </div>
                    <p id="kpi-volume" class="kpi-value">$0.00</p>
                    <p id="kpi-volume-change" style="font-size:11px;color:#9ca3af;margin-top:4px;">
                        0 evaluaciones
                    </p>
                </article>

                <!-- Tasa de rechazo -->
                <article class="kpi-card">
                    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
                        <span style="font-size:11px;font-weight:600;color:#f97316;
                                     text-transform:uppercase;letter-spacing:0.06em;">
                            Tasa de Rechazo
                        </span>
                        <div style="width:28px;height:28px;border-radius:8px;
                                    background:#fff7ed;border:1px solid #fed7aa;
                                    display:flex;align-items:center;justify-content:center;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" stroke="#f97316"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                            </svg>
                        </div>
                    </div>
                    <p id="kpi-rejection" class="kpi-value" style="color:#f97316;">0.0%</p>
                    <p id="kpi-rej-change" style="font-size:11px;color:#9ca3af;margin-top:4px;">
                        0 bloqueadas · 0 con challenge
                    </p>
                </article>

                <!-- Alertas críticas -->
                <article class="kpi-card">
                    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
                        <span style="font-size:11px;font-weight:600;color:#dc2626;
                                     text-transform:uppercase;letter-spacing:0.06em;">
                            Alertas (1h)
                        </span>
                        <div style="width:28px;height:28px;border-radius:8px;
                                    background:#fef2f2;border:1px solid #fca5a5;
                                    display:flex;align-items:center;justify-content:center;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" stroke="#dc2626"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10" />
                                <line x1="12" y1="8" x2="12" y2="12" />
                                <line x1="12" y1="16" x2="12.01" y2="16" />
                            </svg>
                        </div>
                    </div>
                    <div style="display:flex;align-items:center;gap:8px;">
                        <p id="kpi-alerts" class="kpi-value" style="color:#dc2626;">0</p>
                        <span id="kpi-alerts-badge" style="display:none;font-size:10px;font-weight:700;
                                     background:#fef2f2;color:#dc2626;
                                     border:1px solid #fca5a5;padding:2px 8px;
                                     border-radius:999px;animation:pulse 1.5s infinite;">
                            LIVE
                        </span>
                    </div>
                    <p style="font-size:11px;color:#9ca3af;margin-top:4px;">Bloqueadas en la última hora</p>
                </article>

                <!-- Aprobadas -->
                <article class="kpi-card">
                    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
                        <span style="font-size:11px;font-weight:600;color:#16a34a;
                                     text-transform:uppercase;letter-spacing:0.06em;">
                            Aprobadas
                        </span>
                        <div style="width:28px;height:28px;border-radius:8px;
                                    background:#f0fdf4;border:1px solid #bbf7d0;
                                    display:flex;align-items:center;justify-content:center;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" stroke="#16a34a"
                                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                                <polyline points="20 6 9 17 4 12" />
                            </svg>
                        </div>
                    </div>
                    <p id="kpi-approved" class="kpi-value" style="color:#16a34a;">0</p>
                    <p style="font-size:11px;color:#9ca3af;margin-top:4px;">Transacciones en el período</p>
                </article>
            </div>
        </section>

        <!-- ── ROW 2: Feed + Geo ─────────────────────────────────── -->
        <div style="display:grid;grid-template-columns:1fr 1.6fr;gap:1.5rem;">

            <!-- Feed transaccional -->
            <div class="panel-card">
                <div class="panel-header">
                    <span class="panel-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" stroke="#7c3aed"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                        </svg>
                        Feed Transaccional
                    </span>
                    <span style="font-size:11px;color:#9ca3af;font-weight:500;">Últimas 20</span>
                </div>
                <div class="panel-body" style="padding:0.5rem 1.25rem;">
                    <ul id="tx-feed" style="margin:0;padding:0;max-height:420px;overflow-y:auto;">
                        <li style="text-align:center;color:#9ca3af;font-size:12px;padding:2rem;list-style:none;">
                            Cargando transacciones…
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Discrepancias geográficas -->
            <div class="panel-card">
                <div class="panel-header">
                    <span class="panel-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" stroke="#f97316"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                            <circle cx="12" cy="10" r="3" />
                            <path d="M12 21.7C17.3 17 20 13 20 10a8 8 0 1 0-16 0c0 3 2.7 6.9 8 11.7z" />
                        </svg>
                        Discrepancias Geográficas
                    </span>
                    <span style="font-size:11px;background:#fff7ed;color:#f97316;
                                 border:1px solid #fed7aa;padding:2px 8px;
                                 border-radius:999px;font-weight:600;">
                        Mismatch IP / GPS
                    </span>
                </div>
                <div style="overflow-x:auto;max-height:420px;overflow-y:auto;">
                    <table class="geo-table">
                        <thead>
                            <tr>
                                <th>IP</th>
                                <th>País IP</th>
                                <th>País GPS</th>
                                <th>Score</th>
                                <th>Acción</th>
                            </tr>
                        </thead>
                        <tbody id="geo-table-body">
                            <tr>
                                <td colspan="5" style="text-align:center;color:#9ca3af;
                                                       font-size:12px;padding:2rem;">
                                    Cargando…
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ── ROW 3: Heatmap + Identity ────────────────────────── -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;">

            <!-- Heatmap de comercios -->
            <div class="panel-card">
                <div class="panel-header">
                    <span class="panel-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" stroke="#dc2626"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                            <polyline points="9 22 9 12 15 12 15 22" />
                        </svg>
                        Heatmap de Comercios
                    </span>
                    <span style="font-size:11px;color:#9ca3af;font-weight:500;">Ranking por fraude</span>
                </div>
                <div class="panel-body">
                    <div id="heatmap-container">
                        <p style="color:#9ca3af;font-size:12px;text-align:center;padding:1rem;">
                            Cargando…
                        </p>
                    </div>
                </div>
            </div>

            <!-- Identity Risks (Velocity Check) -->
            <div class="panel-card">
                <div class="panel-header">
                    <span class="panel-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" stroke="#7c3aed"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                            <circle cx="12" cy="7" r="4" />
                        </svg>
                        Riesgos de Identidad
                    </span>
                    <span style="font-size:11px;background:#fef2f2;color:#dc2626;
                                 border:1px solid #fca5a5;padding:2px 8px;
                                 border-radius:999px;font-weight:600;">
                        Multi-BIN
                    </span>
                </div>
                <div class="panel-body" style="padding:0.5rem 1.25rem;">
                    <ul id="identity-list" style="margin:0;padding:0;max-height:320px;overflow-y:auto;">
                        <li style="text-align:center;color:#9ca3af;font-size:12px;
                                   padding:2rem;list-style:none;">
                            Cargando…
                        </li>
                    </ul>
                </div>
            </div>
        </div>

    </main>

    <!-- ── FOOTER ───────────────────────────────────────────────── -->
    <footer style="border-top:1px solid #ede9fe;background:white;
                   padding:0.875rem 1.5rem;margin-top:1rem;">
        <div style="max-width:1280px;margin:0 auto;
                    display:flex;align-items:center;justify-content:space-between;
                    font-size:11px;color:#9ca3af;">
            <span>© 2026 LPDV Team · Plux Dashboard v1 · FastAPI Real</span>
            <span id="footer-user" style="font-weight:500;"></span>
        </div>
    </footer>

    <script src="dashboard.js?v=2" defer></script>

</body>

</html>